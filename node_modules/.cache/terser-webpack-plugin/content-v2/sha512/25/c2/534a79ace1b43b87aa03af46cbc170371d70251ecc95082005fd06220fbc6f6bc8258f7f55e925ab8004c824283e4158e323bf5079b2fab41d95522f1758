{"code":"!function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&r&&\"string\"!=typeof e)for(var o in e)t.d(n,o,function(t){return e[t]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,\"a\",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p=\"\",t(t.s=0)}([function(e,t,r){\"use strict\";function n(e,t){function r(){this.constructor=e}S(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function o(e){return\"function\"==typeof e}function i(e){setTimeout(function(){throw e},0)}function s(e){return null!==e&&\"object\"==typeof e}function c(e){return e.reduce(function(e,t){return e.concat(t instanceof P?t.errors:t)},[])}function u(e){return e}function a(e){if(e||(e=O.Promise||Promise),!e)throw new Error(\"no Promise impl found\");return e}function h(e){return e?function(e){return new D(function(t){return e.schedule(function(){return t.complete()})})}(e):z}function f(e,t){return new D(function(r){var n=new C,o=0;return n.add(t.schedule(function(){return o===e.length?void r.complete():(r.next(e[o++]),void(!r.closed&&n.add(this.schedule())))})),n})}function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[e.length-1];return function(e){return e&&\"function\"==typeof e.schedule}(r)?(e.pop(),f(e,r)):function(e,t){return t?f(e,t):new D(Q(e))}(e)}function d(e,t){return new D(t?function(r){return t.schedule(p,0,{error:e,subscriber:r})}:function(t){return t.error(e)})}function p(e){var t=e.error;e.subscriber.error(t)}function b(e,t){function r(){this.constructor=e}B(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function v(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],s=0,c=i.length;s<c;s++,o++)n[o]=i[s];return n}function y(e){return\"function\"==typeof e}function m(e){setTimeout(function(){throw e},0)}function w(e){return null!==e&&\"object\"==typeof e}function E(e){return e.reduce(function(e,t){return e.concat(t instanceof ct?t.errors:t)},[])}function _(){}r.r(t);var g,S=function(e,t){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},x=!1,O={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn(\"DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \\n\"+t.stack)}else x&&console.log(\"RxJS: Back to a better error behavior. Thank you. <3\");x=e},get useDeprecatedSynchronousErrorHandling(){return x}},M={closed:!0,next:function(){},error:function(e){if(O.useDeprecatedSynchronousErrorHandling)throw e;i(e)},complete:function(){}},T=Array.isArray||function(e){return e&&\"number\"==typeof e.length},P=function(){function e(e){return Error.call(this),this.message=e?e.length+\" errors occurred during unsubscription:\\n\"+e.map(function(e,t){return t+1+\") \"+e.toString()}).join(\"\\n  \"):\"\",this.name=\"UnsubscriptionError\",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),C=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var r=this,n=r._parentOrParents,i=r._ctorUnsubscribe,u=r._unsubscribe,a=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(var h=0;h<n.length;++h)n[h].remove(this);if(o(u)){i&&(this._unsubscribe=void 0);try{u.call(this)}catch(r){t=r instanceof P?c(r.errors):[r]}}if(T(a)){h=-1;for(var f,l=a.length;++h<l;)if(s(f=a[h]))try{f.unsubscribe()}catch(r){t=t||[],r instanceof P?t=t.concat(c(r.errors)):t.push(r)}}if(t)throw new P(t)}},e.prototype.add=function(t){var r=t;if(!t)return e.EMPTY;switch(typeof t){case\"function\":r=new e(t);case\"object\":if(r===this||r.closed||\"function\"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof e)){var n=r;(r=new e)._subscriptions=[n]}break;default:throw new Error(\"unrecognized teardown \"+t+\" added to Subscription.\")}var o=r._parentOrParents;if(null===o)r._parentOrParents=this;else if(o instanceof e){if(o===this)return r;r._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return r;o.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[r]:i.push(r),r},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var r=t.indexOf(e);-1!==r&&t.splice(r,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}(),N=\"function\"==typeof Symbol?Symbol(\"rxSubscriber\"):\"@@rxSubscriber_\"+Math.random(),R=function(e){function t(r,n,o){var i=e.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=M;break;case 1:if(!r){i.destination=M;break}if(\"object\"==typeof r){r instanceof t?(i.syncErrorThrowable=r.syncErrorThrowable,i.destination=r,r.add(i)):(i.syncErrorThrowable=!0,i.destination=new A(i,r));break}default:i.syncErrorThrowable=!0,i.destination=new A(i,r,n,o)}return i}return n(t,e),t.prototype[N]=function(){return this},t.create=function(e,r,n){var o=new t(e,r,n);return o.syncErrorThrowable=!1,o},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(C),A=function(e){function t(t,r,n,i){var s=e.call(this)||this;s._parentSubscriber=t;var c,u=s;return o(r)?c=r:r&&(c=r.next,n=r.error,i=r.complete,r!==M&&(o((u=Object.create(r)).unsubscribe)&&s.add(u.unsubscribe.bind(u)),u.unsubscribe=s.unsubscribe.bind(s))),s._context=u,s._next=c,s._error=n,s._complete=i,s}return n(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;O.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,r=O.useDeprecatedSynchronousErrorHandling;if(this._error)r&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)r?(t.syncErrorValue=e,t.syncErrorThrown=!0):i(e),this.unsubscribe();else{if(this.unsubscribe(),r)throw e;i(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var r=function(){return e._complete.call(e._context)};O.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),O.useDeprecatedSynchronousErrorHandling)throw e;i(e)}},t.prototype.__tryOrSetError=function(e,t,r){if(!O.useDeprecatedSynchronousErrorHandling)throw new Error(\"bad call\");try{t.call(this._context,r)}catch(t){return O.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(i(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(R),j=\"function\"==typeof Symbol&&Symbol.observable||\"@@observable\",D=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n=this.operator,o=function(e,t,r){if(e){if(e instanceof R)return e;if(e[N])return e[N]()}return e||t||r?new R(e,t,r):new R(M)}(e,t,r);if(n?o.add(n.call(o,this.source)):o.add(this.source||O.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),O.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){O.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){var t=e,r=t.closed,n=t.destination,o=t.isStopped;if(r||o)return!1;e=n&&n instanceof R?n:null}return!0}(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=a(t))(function(t,n){var o=r.subscribe(function(t){try{e(t)}catch(e){n(e),o&&o.unsubscribe()}},n,t)})},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[j]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:function(e){return 0===e.length?u:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}}(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=a(e))(function(e,r){var n;t.subscribe(function(e){return n=e},function(e){return r(e)},function(){return e(n)})})},e.create=function(t){return new e(t)},e}(),I=function(){function e(){return Error.call(this),this.message=\"object unsubscribed\",this.name=\"ObjectUnsubscribedError\",this}return e.prototype=Object.create(Error.prototype),e}(),k=function(e){function t(t,r){var n=e.call(this)||this;return n.subject=t,n.subscriber=r,n.closed=!1,n}return n(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var r=t.indexOf(this.subscriber);-1!==r&&t.splice(r,1)}}},t}(C),q=function(e){function t(t){var r=e.call(this,t)||this;return r.destination=t,r}return n(t,e),t}(R),U=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return n(t,e),t.prototype[N]=function(){return new q(this)},t.prototype.lift=function(e){var t=new H(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new I;if(!this.isStopped)for(var t=this.observers,r=t.length,n=t.slice(),o=0;o<r;o++)n[o].next(e)},t.prototype.error=function(e){if(this.closed)throw new I;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,r=t.length,n=t.slice(),o=0;o<r;o++)n[o].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new I;this.isStopped=!0;for(var e=this.observers,t=e.length,r=e.slice(),n=0;n<t;n++)r[n].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new I;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new I;return this.hasError?(e.error(this.thrownError),C.EMPTY):this.isStopped?(e.complete(),C.EMPTY):(this.observers.push(e),new k(this,e))},t.prototype.asObservable=function(){var e=new D;return e.source=this,e},t.create=function(e,t){return new H(e,t)},t}(D),H=function(e){function t(t,r){var n=e.call(this)||this;return n.destination=t,n.source=r,n}return n(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):C.EMPTY},t}(U),$=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.scheduler=t,n.work=r,n}return n(t,e),t.prototype.schedule=function(t,r){return void 0===r&&(r=0),0<r?e.prototype.schedule.call(this,t,r):(this.delay=r,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,r){return 0<r||this.closed?e.prototype.execute.call(this,t,r):this._execute(t,r)},t.prototype.requestAsyncId=function(t,r,n){return void 0===n&&(n=0),null!==n&&0<n||null===n&&0<this.delay?e.prototype.requestAsyncId.call(this,t,r,n):t.flush(this)},t}(function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.scheduler=t,n.work=r,n.pending=!1,n}return n(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,n=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(n,r,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(n,this.id,t),this},t.prototype.requestAsyncId=function(e,t,r){return void 0===r&&(r=0),setInterval(e.flush.bind(e,this),r)},t.prototype.recycleAsyncId=function(e,t,r){return void 0===r&&(r=0),null!==r&&this.delay===r&&!1===this.pending?t:void clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error(\"executing a cancelled action\");this.pending=!1;var r=this._execute(e,t);return r||void(!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null)))},t.prototype._execute=function(e){var t=!1,r=void 0;try{this.work(e)}catch(e){t=!0,r=!!e&&e||new Error(e)}if(t)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,r=t.actions,n=r.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==n&&r.splice(n,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(){return e.call(this)||this}return n(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(C))),V=function(){function e(t,r){void 0===r&&(r=e.now),this.SchedulerAction=t,this.now=r}return e.prototype.schedule=function(e,t,r){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(r,t)},e.now=function(){return Date.now()},e}(),L=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(function(e){function t(r,n){void 0===n&&(n=V.now);var o=e.call(this,r,function(){return t.delegate&&t.delegate!==o?t.delegate.now():n()})||this;return o.actions=[],o.active=!1,o.scheduled=void 0,o}return n(t,e),t.prototype.schedule=function(r,n,o){return void 0===n&&(n=0),t.delegate&&t.delegate!==this?t.delegate.schedule(r,n,o):e.prototype.schedule.call(this,r,n,o)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var r;this.active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}},t}(V)))($),z=new D(function(e){return e.complete()}),Q=function(e){return function(t){for(var r=0,n=e.length;r<n&&!t.closed;r++)t.next(e[r]);t.complete()}};!function(e){e.NEXT=\"N\",e.ERROR=\"E\",e.COMPLETE=\"C\"}(g||(g={}));var Y=function(){function e(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue=\"N\"===e}return e.prototype.observe=function(e){switch(this.kind){case\"N\":return e.next&&e.next(this.value);case\"E\":return e.error&&e.error(this.error);case\"C\":return e.complete&&e.complete()}},e.prototype.do=function(e,t,r){var n=this.kind;return\"N\"===n?e&&e(this.value):\"E\"===n?t&&t(this.error):\"C\"===n?r&&r():void 0},e.prototype.accept=function(e,t,r){return e&&\"function\"==typeof e.next?this.observe(e):this.do(e,t,r)},e.prototype.toObservable=function(){switch(this.kind){case\"N\":return l(this.value);case\"E\":return d(this.error);case\"C\":return h()}throw new Error(\"unexpected notification kind value\")},e.createNext=function(t){return void 0===t?e.undefinedValueNotification:new e(\"N\",t)},e.createError=function(t){return new e(\"E\",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e(\"C\"),e.undefinedValueNotification=new e(\"N\",void 0),e}(),G=(function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}e.prototype.call=function(e,t){return t.subscribe(new G(e,this.scheduler,this.delay))}}(),function(e){function t(t,r,n){void 0===n&&(n=0);var o=e.call(this,t)||this;return o.scheduler=r,o.delay=n,o}return n(t,e),t.dispatch=function(e){var t=e.notification,r=e.destination;t.observe(r),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new W(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(Y.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(Y.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(Y.createComplete()),this.unsubscribe()},t}(R)),W=function(e,t){this.notification=e,this.destination=t},F=function(e){function t(t,r,n){var o=Number.POSITIVE_INFINITY;void 0===t&&(t=o),void 0===r&&(r=o);var i=e.call(this)||this;return i.scheduler=n,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=1>t?1:t,i._windowTime=1>r?1:r,r===o?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return n(t,e),t.prototype.nextInfiniteTimeWindow=function(t){if(!this.isStopped){var r=this._events;r.push(t),r.length>this._bufferSize&&r.shift()}e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this.isStopped||(this._events.push(new J(this._getNow(),t)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,r=this._infiniteTimeWindow,n=r?this._events:this._trimBufferThenGetEvents(),o=this.scheduler,i=n.length;if(this.closed)throw new I;if(this.isStopped||this.hasError?t=C.EMPTY:(this.observers.push(e),t=new k(this,e)),o&&e.add(e=new G(e,o)),r)for(var s=0;s<i&&!e.closed;s++)e.next(n[s]);else for(s=0;s<i&&!e.closed;s++)e.next(n[s].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||L).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,r=this._windowTime,n=this._events,o=n.length,i=0;i<o&&!(e-n[i].time<r);)i++;return o>t&&(i=Math.max(i,o-t)),0<i&&n.splice(0,i),n},t}(U),J=function(e,t){this.time=e,this.value=t},B=function(e,t){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},X=function(){return(X=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};const K=(e,t)=>{if(!e)throw new Error(t)},Z=e=>void 0!==e,ee=(e,t=\"Expect to be defined\")=>{K(Z(e),t)},te=e=>\"string\"==typeof e||e instanceof String,re=(e,t=\"Expected to be a string\")=>{K(Z(e)&&te(e),t)},ne=(e,t=\"Expected to be non empty string\")=>{re(e,t),K(0<e.length,t)},oe=e=>Array.isArray(e),ie=(e,t=\"Expected to be an array\")=>{K(oe(e),t)},se=(e,t=\"Expected to be an array\")=>{K((e=>oe(e)&&0<e.length)(e),t)},ce=e=>\"[object Object]\"===Object.prototype.toString.call(e),ue=(e,t=\"Expected to be an object\")=>{K(ce(e),t)},ae=(e,t=\"Expected to be non empty object\")=>{ue(e,t),K(0<Object.keys(e).length,t)},he=(e,t)=>oe(e)?e.includes(t):!!ce(e)&&Object.values(e).includes(t),fe=e=>\"function\"==typeof e&&!/^class\\s/.test(Function.prototype.toString.call(e)),le=(e,t=\"Expected to be a number\")=>{K((e=>\"number\"==typeof e&&!isNaN(e))(e),t)},de=\"Not a valid protocol\",pe=\"Address must be of type object\",be={REQUEST_RESPONSE:\"requestResponse\",REQUEST_STREAM:\"requestStream\"},ve=(e,t=!0)=>{if(t&&void 0===e)return!0;ae(e,pe);const{host:r,path:n,protocol:o}=e;let{port:i}=e;return i=te(i)?+i:i,re(r,\"Not a valid host\"),re(n,\"Not a valid path\"),le(i,\"Not a valid port\"),re(o,de),K(he([\"pm\",\"ws\",\"wss\",\"tcp\"],o),de),!0},ye=e=>{ve(e,!1);const{host:t,path:r,port:n,protocol:o}=e;return`${o}://${t}:${n}/${r}`},me=e=>{const t={};return e=we({key:\"protocol\",optionalValue:\"pm\",delimiter:\"://\",str:e,newAddress:t}),e=we({key:\"host\",optionalValue:\"defaultHost\",delimiter:\":\",str:e,newAddress:t}),e=we({key:\"port\",optionalValue:8080,delimiter:\"/\",str:e,newAddress:t}),t.path=e,t},we=({key:e,optionalValue:t,delimiter:r,newAddress:n,str:o})=>{let[i,s]=o.split(r);return s||(s=i,i=t),n[e]=i,s},Ee=()=>{try{return!navigator}catch(e){return!1}},_e={},ge=(e,t,r,n,o=\"log\")=>{if(_e[e]||(_e[e]=(()=>{let e=\"#\";for(let t=0;6>t;t++)e+=\"0123456789ABCDEF\"[Math.floor(16*Math.random())];return e})()),n){const n=`color:${_e[e]}`;r&&console[o](`%c******** address: ${e}********`,n),console[o](t),r&&Object.keys(r).forEach(e=>{Array.isArray(r[e])?Object.values(r[e]).forEach(t=>{console[o](`${e}: ${JSON.stringify(t.qualifier||t,null,2)}`)}):console[o](`${e}: ${JSON.stringify(r[e],null,2)}`)})}},Se=({serviceName:e,methodName:t})=>`${e}/${t}`,xe=e=>{ae(e);const{serviceName:t,methods:r}=e;ee(t,\"MS0020 - Invalid format, definition must contain valid serviceName\"),ne(t,(e=>`MS0023 - Invalid format, serviceName must be not empty string but received type ${typeof e}`)(t)),ee(r,\"MS0021 - Invalid format, definition must contain valid methods\"),ae(r,\"MS0022 - Invalid format, definition must contain valid methods\"),Object.keys(r).forEach(e=>{ne(e);const n=Se({serviceName:t,methodName:e});Oe(n,r[e])})},Oe=(e,t)=>{ae(t,(e=>`Method value for ${e} definition should be non empty object`)(e));const{asyncModel:r}=t;ee(r,(e=>`Async model is not provided in service definition for ${e}`)(e)),((e,t,r=\"Expected to be one of the collection elements\")=>{K(he(e,t),r)})(be,r,(e=>`Invalid async model in service definition for ${e}`)(e))};class Me{constructor(e){this.onmessage=null,this.onmessageerror=null,this.otherPort=null,this.onmessageListeners=[],this.queue=[],this.otherSideStart=!1,this.whoami=e}dispatchEvent(e){return this.onmessage&&this.onmessage(e),this.onmessageListeners.forEach(t=>t(e)),!0}postMessage(e,t){const r={ports:t,data:e};this.otherPort&&(this.otherSideStart?this.otherPort.dispatchEvent(r):this.queue.push(r))}addEventListener(e,t){\"message\"!==e||\"function\"!=typeof t||-1!==this.onmessageListeners.indexOf(t)||this.onmessageListeners.push(t)}removeEventListener(e,t){if(\"message\"===e){const e=this.onmessageListeners.indexOf(t);-1===e||this.onmessageListeners.splice(e,1)}}start(){setTimeout(()=>this.otherPort&&this.otherPort.startSending.apply(this.otherPort,[]),0)}close(){setTimeout(()=>this.otherPort&&this.otherPort.stopSending.apply(this.otherPort,[]),0)}startSending(){this.otherSideStart=!0,this.queue.forEach(e=>this.otherPort&&this.otherPort.dispatchEvent(e))}stopSending(){this.otherSideStart=!1,this.queue.length=0}}class Te{constructor(){this.port1=new Me(\"client\"),this.port2=new Me(\"server\"),this.port1.otherPort=this.port2,this.port2.otherPort=this.port1}}const Pe=\"undefined\"!=typeof window&&window.Math===Math?window:\"undefined\"!=typeof self&&self.Math===Math?self:Function(\"return this\")();Pe.MessagePort&&Pe.MessageChannel||(Pe.MessagePort=Me,Pe.MessageChannel=Te),Ee();var Ce=\"Must provide cluster when running on nodejs\",Ne=function(e){var t=e.address,r=e.itemsToPublish,n=e.seedAddress,o=e.debug,i=e.cluster,s=new F;if(!i)return ge(ye(t),Ce,{},o,\"warn\"),s.complete(),{destroy:function(){return Promise.resolve(Ce)},discoveredItems$:function(){return s.asObservable()}};var c={};ve(t,!1),n&&n.forEach(function(e){ve(e,!1),Re(t,e)}),ie(r,\"itemsToPublish are not of type Array\");var u,a=i({address:t,seedAddress:n,itemsToPublish:r,debug:!1}),h=a.listen$();return Object.freeze({destroy:function(){return u&&u.unsubscribe(),s.complete(),new Promise(function(e,r){a.destroy().then(function(){return e(function(e){return ye(e)+\" has been removed\"}(t))}).catch(function(e){return r(e)})})},discoveredItems$:function(){return a.getCurrentMembersData().then(function(e){Object.keys(e).forEach(function(t){var r=e[t];0===r.length?s.next({type:\"IDLE\",items:[]}):!c[t]&&(c[t]=!0,s.next({type:\"REGISTERED\",items:r}))})}).catch(function(e){return s.error(e)}),u=h.subscribe(function(e){var t=e.type,r=e.items,n=e.from;0<r.length&&(\"REMOVED\"===t&&c[n]&&(c[n]=!1,s.next({type:\"UNREGISTERED\",items:r})),\"REMOVED\"!==t&&!c[n]&&(c[n]=!0,s.next({type:\"REGISTERED\",items:r})))},function(e){return s.error(e)},function(){return s.complete()}),s.asObservable()}})},Re=function(e,t){var r=ye(e),n=ye(t);if(r===n)throw new Error(function(e,t){return\"address \"+e+\" must be different from the seed Address \"+t}(r,n))},Ae=be,je=\"MS0000 - microservice does not exists\",De=\"MS0005 - qualifier expected to be service/method format\",Ie=function(e,t){return\"MS0016 - asyncModel does not match, expect \"+e+\", but received \"+t},ke=function(e){return\"Can't find method \"+e.qualifier},qe=function(e,t){return\"MS0025 - \"+e+\"'s service '\"+t+\"' define as Promise but service return not Promise\"},Ue=function(e,t){return\"MS0026 - \"+e+\"'s service '\"+t+\"' define as Observable but service return not Observable\"},He=function(e,t){return\"MS0027 - \"+e+\"'s \"+t+\" has no valid response, expect Promise or Observable\"},$e=function(e){ie(e,\"MS0008 - Not valid format, services must be an Array\"),e.forEach(Ve)},Ve=function(e){ae(e,\"MS0009 - Not valid format, service must be an Object\");var t=e.definition,r=e.reference;ee(t,\"MS0006 - Service missing definition\"),xe(t);var n=t.serviceName;ee(r,function(e){return\"MS0018 - service does not uphold the contract, \"+e+\" is not provided\"}(n))},Le=function(e,t){var r=t.serviceName;ue(e,function(e){return\"MS0019 - Not valid format, \"+e+\" reference must be an Object\"}(r)),Object.keys(t.methods).forEach(function(t){var n=Se({serviceName:r,methodName:t}),o=e.constructor&&e.constructor[t];((e,t=\"Expected to be a function\")=>{K(fe(e),t)})(e[t]||o,function(e){return\"MS0017 - service (\"+e+\") has valid definition but reference is not a function.\"}(n))})},ze=function(e){ne(e,\"MS0011 - qualifier should not be empty string\");var t=e.split(\"/\");K(2===t.length,De),ne(t[0],De),ne(t[1],De)},Qe=function(e){var t=e.errorMessage,r=e.microserviceContext,n=new Error(t);if(r){var o=r.whoAmI,i=r.debug;ge(o,t,{},i,\"warn\")}return n},Ye=function(e,t){return e===Ae.REQUEST_RESPONSE?Promise.reject(t):new D(function(e){e.error(t)})},Ge=function(e,t){return function(r,n){ge(e,r,{},t,n)}},We=function(e){var t=e.router,r=e.microserviceContext,n=e.message,o=e.asyncModel,i=e.transportClient;return new Promise(function(e,s){t({lookUp:r.remoteRegistry.lookUp,message:n}).then(function(t){var n=t.asyncModel;n!==o&&s(Qe({errorMessage:Ie(o,n),microserviceContext:r})),i||s(Qe({errorMessage:\"MS0013 - Transport provider is not define\",microserviceContext:r})),e(t)}).catch(function(){var e,t;s(Qe({errorMessage:(e=r.whoAmI,t=n.qualifier,\"MS0015 - \"+e+\" can't find services that match the give criteria: '\"+JSON.stringify(t)+\"'\"),microserviceContext:r}))})})},Fe=function(e){var t=e.router,r=e.microserviceContext,n=e.transportClient;return function(e){var o=e.message,i=e.asyncModel;try{!function(e){ee(e,\"MS0001 - Message has not been provided\"),ae(e,\"MS0004 - Message should not to be empty object\");var t=e.data,r=e.qualifier;ee(r,\"MS0003 - Message qualifier has not been provided\"),ze(r),ee(t,\"MS0002 - Message data has not been provided\"),ie(t,\"MS0007 - Message format error: data must be Array\")}(o)}catch(e){var s=Qe({errorMessage:e.message,microserviceContext:r});return i===Ae.REQUEST_RESPONSE?Promise.reject(s):d(s)}var c=r.localRegistry.lookUp({qualifier:o.qualifier});return c?function(e){var t=e.localService,r=e.asyncModel,n=e.message,o=e.microserviceContext,i=t.reference,s=t.asyncModel,c=i&&i[t.methodName];if(!c)return Ye(r,Qe({errorMessage:ke(n),microserviceContext:o}));if(s!==r)return Ye(r,Qe({errorMessage:Ie(r,s),microserviceContext:o}));var u=c.apply(void 0,n.data);return\"object\"==typeof u&&u?r===Ae.REQUEST_STREAM?new D(function(e){if(fe(u.subscribe)){var t=u.subscribe(function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.next.apply(e,t)},function(t){return e.error(t)},function(){return e.complete()});return function(){return t.unsubscribe()}}e.error(Qe({errorMessage:Ue(o.whoAmI,n.qualifier),microserviceContext:o}))}):r===Ae.REQUEST_RESPONSE?new Promise(function(e,t){fe(u.then)?u.then(e).catch(t):t(Qe({errorMessage:qe(o.whoAmI,n.qualifier),microserviceContext:o}))}):Ye(r,Qe({errorMessage:\"MS0028 - invalid async model\",microserviceContext:o})):Ye(r,Qe({errorMessage:He(o.whoAmI,n.qualifier),microserviceContext:o}))}({localService:c,asyncModel:i,message:o,microserviceContext:r}):function(e){var t=e.asyncModel,r=e.transportClient,n=e.microserviceContext,o=e.message,i=Ge(n.whoAmI,n.debug);switch(t){case Ae.REQUEST_STREAM:var s=!1,c=function(){s=!0};return new D(function(t){return We(e).then(function(e){r.start({remoteAddress:e.address,logger:i}).then(function(e){var r=e.requestStream;if(!s){var n=r(o).subscribe(function(e){return t.next(e)},function(e){return t.error(e)},function(){return t.complete()});c=function(){return n.unsubscribe()}}}).catch(function(e){return t.error(e)})}).catch(function(e){return t.error(e)}),function(){return c()}});case Ae.REQUEST_RESPONSE:return new Promise(function(t,n){We(e).then(function(e){r.start({remoteAddress:e.address,logger:i}).then(function(e){(0,e.requestResponse)(o).then(function(e){return t(e)}).catch(function(e){return n(e)})}).catch(function(e){return n(e)})}).catch(function(e){return n(e)})});default:throw new Error(\"invalid async model\")}}({router:t,microserviceContext:r,message:o,asyncModel:i,transportClient:n})}},Je=function(e){var t=e.router,r=e.microserviceContext,n=e.transportClient;if(!r)throw new Error(je);var o=Fe({router:t,microserviceContext:r,transportClient:n});return Object.freeze({requestStream:function(e){return o({message:e,asyncModel:Ae.REQUEST_STREAM})},requestResponse:function(e){return o({message:e,asyncModel:Ae.REQUEST_RESPONSE})}})},Be=function(e){var t=e.services,r=e.address;return t&&r?t.reduce(function(e,t){return v(e,Ke({service:t,address:r}))},[]):[]},Xe=function(e){var t=e.type,r=e.items,n=e.remoteRegistryMap;return\"REGISTERED\"===t?n=r.reduce(function(e,t){var r;return X(X({},e),((r={})[t.qualifier]=v(e[t.qualifier]||[],[t]),r))},n||{}):\"UNREGISTERED\"===t&&r.forEach(function(e){n[e.qualifier]=n[e.qualifier].filter(function(t){return ye(t.address)!==ye(e.address)})}),X({},n)},Ke=function(e){var t=e.service,r=e.address,n=t.definition,o=n.serviceName,i=n.methods;return Object.keys(i).map(function(e){return{qualifier:Se({serviceName:o,methodName:e}),serviceName:o,methodName:e,asyncModel:i[e].asyncModel,address:r}})||[]},Ze=function(e){var t=e.reference,r=e.methodName,n=t[r];return n?n.bind(t):t.constructor&&t.constructor[r]},et=function(e){var t=e.services;return(void 0===t?[]:t).reduce(function(e,t){return v(e,rt({service:t}))},[])},tt=function(e){var t=e.localRegistryMap,r=e.references;return X(X({},t),r.reduce(function(e,t){var r;return X(X({},e),((r={})[t.qualifier]=t,r))},t||{}))},rt=function(e){var t=e.service,r=[],n=t.definition,o=t.reference,i=n.serviceName,s=n.methods;return Object.keys(s).forEach(function(e){var t,n=Se({serviceName:i,methodName:e});r.push({qualifier:n,serviceName:i,methodName:e,asyncModel:s[e].asyncModel,reference:(t={},t[e]=Ze({reference:o,methodName:e}),t)})}),r},nt=!1,ot={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn(\"DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \\n\"+t.stack)}nt=e},get useDeprecatedSynchronousErrorHandling(){return nt}},it={closed:!0,next:function(){},error:function(e){if(ot.useDeprecatedSynchronousErrorHandling)throw e;m(e)},complete:function(){}},st=Array.isArray||function(e){return e&&\"number\"==typeof e.length},ct=function(){function e(e){return Error.call(this),this.message=e?e.length+\" errors occurred during unsubscription:\\n\"+e.map(function(e,t){return t+1+\") \"+e.toString()}).join(\"\\n  \"):\"\",this.name=\"UnsubscriptionError\",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),ut=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var r=this,n=r._parentOrParents,o=r._unsubscribe,i=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(var s=0;s<n.length;++s)n[s].remove(this);if(y(o))try{o.call(this)}catch(r){t=r instanceof ct?E(r.errors):[r]}if(st(i)){s=-1;for(var c,u=i.length;++s<u;)if(w(c=i[s]))try{c.unsubscribe()}catch(r){t=t||[],r instanceof ct?t=t.concat(E(r.errors)):t.push(r)}}if(t)throw new ct(t)}},e.prototype.add=function(t){var r=t;if(!t)return e.EMPTY;switch(typeof t){case\"function\":r=new e(t);case\"object\":if(r===this||r.closed||\"function\"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof e)){var n=r;(r=new e)._subscriptions=[n]}break;default:throw new Error(\"unrecognized teardown \"+t+\" added to Subscription.\")}var o=r._parentOrParents;if(null===o)r._parentOrParents=this;else if(o instanceof e){if(o===this)return r;r._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return r;o.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[r]:i.push(r),r},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var r=t.indexOf(e);-1!==r&&t.splice(r,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}(),at=\"function\"==typeof Symbol?Symbol(\"rxSubscriber\"):\"@@rxSubscriber_\"+Math.random(),ht=function(e){function t(r,n,o){var i=e.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=it;break;case 1:if(!r){i.destination=it;break}if(\"object\"==typeof r){r instanceof t?(i.syncErrorThrowable=r.syncErrorThrowable,i.destination=r,r.add(i)):(i.syncErrorThrowable=!0,i.destination=new ft(i,r));break}default:i.syncErrorThrowable=!0,i.destination=new ft(i,r,n,o)}return i}return b(t,e),t.prototype[at]=function(){return this},t.create=function(e,r,n){var o=new t(e,r,n);return o.syncErrorThrowable=!1,o},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(ut),ft=function(e){function t(t,r,n,o){var i=e.call(this)||this;i._parentSubscriber=t;var s,c=i;return y(r)?s=r:r&&(s=r.next,n=r.error,o=r.complete,r!==it&&(y((c=Object.create(r)).unsubscribe)&&i.add(c.unsubscribe.bind(c)),c.unsubscribe=i.unsubscribe.bind(i))),i._context=c,i._next=s,i._error=n,i._complete=o,i}return b(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;ot.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,r=ot.useDeprecatedSynchronousErrorHandling;if(this._error)r&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)r?(t.syncErrorValue=e,t.syncErrorThrown=!0):m(e),this.unsubscribe();else{if(this.unsubscribe(),r)throw e;m(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var r=function(){return e._complete.call(e._context)};ot.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),ot.useDeprecatedSynchronousErrorHandling)throw e;m(e)}},t.prototype.__tryOrSetError=function(e,t,r){if(!ot.useDeprecatedSynchronousErrorHandling)throw new Error(\"bad call\");try{t.call(this._context,r)}catch(t){return ot.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(m(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(ht),lt=function(){function e(e,t,r){this.nextOrObserver=e,this.error=t,this.complete=r}return e.prototype.call=function(e,t){return t.subscribe(new dt(e,this.nextOrObserver,this.error,this.complete))},e}(),dt=function(e){function t(t,r,n,o){var i=e.call(this,t)||this;return i._tapNext=_,i._tapError=_,i._tapComplete=_,i._tapError=n||_,i._tapComplete=o||_,y(r)?(i._context=i,i._tapNext=r):r&&(i._context=r,i._tapNext=r.next||_,i._tapError=r.error||_,i._tapComplete=r.complete||_),i}return b(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(ht),pt=function(e){var t=e.serviceCall,r=e.serviceDefinition;return function(e,n){if(!r.methods[n])throw new Error(function(e){return\"MS0014 - service method '\"+e+\"' missing in the serviceDefinition\"}(n));var o=r.methods[n].asyncModel;return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var s={qualifier:Se({serviceName:r.serviceName,methodName:n}),data:e};return t({message:s,asyncModel:o})}}},bt=function(e){var t=e.router,r=e.serviceDefinition,n=e.microserviceContext,o=e.transportClient;if(!n)throw new Error(je);return xe(r),function(e){var t=e.serviceCall,r=e.serviceDefinition,n={};return Object.keys(r.methods).forEach(function(e){return n[e]=function(){throw Error(\"MS0029 - Proxy not supported, please add Proxy polyfill\")}}),new Proxy(n,{get:pt({serviceDefinition:r,serviceCall:t})})}({serviceCall:Fe({router:t,microserviceContext:n,transportClient:o}),serviceDefinition:r})},vt=function(e){var t=e.transportClient,r=e.serverStop,n=e.discoveryInstance,o=e.debug,i=e.defaultRouter,s=e.microserviceContext,c=s.remoteRegistry;n&&n.discoveredItems$().pipe(mt(s.whoAmI,o)).subscribe(c.update);var u=yt({microserviceContext:s,transportClient:t,defaultRouter:i});return Object.freeze(X({destroy:function(){return function(e){var t=e.discovery,r=e.serverStop,n=e.transportClientDestroy,o=e.microserviceContext;if(!o)throw new Error(je);var i=Ge(o.whoAmI,o.debug);return new Promise(function(e){if(o){var s=o.localRegistry,c=o.remoteRegistry;s.destroy(),c.destroy(),n({address:o.whoAmI,logger:i})}r&&r(),t&&t.destroy().then(function(){e(\"\"),o=null})})}({microserviceContext:s,discovery:n,serverStop:r,transportClientDestroy:t.destroy})}},u))},yt=function(e){var t=e.microserviceContext,r=e.transportClient,n=e.defaultRouter;return{createProxy:function(e){var o=e.serviceDefinition,i=e.router;return bt({serviceDefinition:o,router:void 0===i?n:i,microserviceContext:t,transportClient:r})},createServiceCall:function(e){var o=e.router;return Je({router:void 0===o?n:o,microserviceContext:t,transportClient:r})}}},mt=function(e,t){return function(e,t,r){return function(n){return n.lift(new lt(e,t,r))}}(function(r){var n,o=r.type,i=r.items;return\"IDLE\"!==o&&ge(e,\"microservice received an updated\",((n={})[o]=i.map(function(e){return e.qualifier}),n),t)})},wt=function(e){var t=e.address,r=e.debug;return{remoteRegistry:function(){var e={};return Object.freeze({lookUp:function(t){var r=t.qualifier;if(!e)throw new Error(je);return e[r]||[]},createEndPoints:function(t){if(!e)throw new Error(je);return Be(t)},update:function(t){var r=t.type,n=t.items;if(\"IDLE\"!==r){if(!e)throw new Error(je);e=Xe({type:r,items:n,remoteRegistryMap:e})}},destroy:function(){e=null}})}(),localRegistry:function(){var e={};return Object.freeze({lookUp:function(t){var r=t.qualifier;if(!e)throw new Error(je);return e[r]||null},add:function(t){var r=t.services,n=void 0===r?[]:r;if(!e)throw new Error(je);var o=et({services:n});e=tt({localRegistryMap:e,references:o})},destroy:function(){e=null}})}(),debug:r,whoAmI:ye(t)}},Et=function(e){return oe(e)?e.map(function(e){return te(e)?me(e):e}):te(e)?[me(e)]:[e]};console.log({createMicroservice:function(e){var t=X({defaultRouter:function(){throw new Error(\"MS0024 - Router is not define\")},services:[],debug:!1,transport:{clientTransport:{start:function(){throw new Error(\"client transport not provided\")}},serverTransport:function(){throw new Error(\"server transport not provided\")}}},e);te(t.address)&&(t=X(X({},t),{address:me(t.address)})),function(e){ue(e,\"MS0000 - Not valid format, MicroserviceOptions must be an Object\");var t=e.services,r=e.seedAddress,n=e.address;void 0!==r&&(se(r,pe),r.forEach(function(e){ve(e,!0)})),ve(n,!0),$e(t)}(t=X(X({},t),{seedAddress:t.seedAddress?Et(t.seedAddress):t.seedAddress}));var r=t.cluster,n=t.debug,o=t.transport,i=t.address,s=t.seedAddress,c=o.clientTransport,u=i||me(Date.now().toString()),a=wt({address:u,debug:n||!1}),h=a.remoteRegistry,f=a.localRegistry,l=yt({microserviceContext:a,transportClient:c,defaultRouter:t.defaultRouter}),d=t?function(e){var t=e.services,r=e.serviceFactoryOptions;return t&&Array.isArray(t)?t.map(function(e){var t=e.reference,n=e.definition;if(fe(t)){var o=t(r);return Le(o,n),{reference:o,definition:n}}return Le(t,n),{reference:t,definition:n}}):t}({services:t.services,serviceFactoryOptions:l}):[];f.add({services:d,address:i});var p=i&&h.createEndPoints({services:d,address:i})||[],b=Ne({address:u,itemsToPublish:p,seedAddress:s,cluster:r,debug:n});b&&function(e){ee(e,\"\");var t=e.discoveredItems$,r=e.destroy;ee(t,\"\"),ee(r,\"\")}(b);var v=i&&o?o.serverTransport({logger:Ge(a.whoAmI,a.debug),localAddress:i,serviceCall:Je({router:t.defaultRouter,microserviceContext:a,transportClient:c})}):function(){};return vt({microserviceContext:a,transportClient:c,discoveryInstance:b,serverStop:v,debug:n,defaultRouter:t.defaultRouter})}})}]);","extractedComments":[]}